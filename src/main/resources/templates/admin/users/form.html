<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${user.id != null ? 'Edit User' : 'New User'} + ' - Admin Panel'">User Form</title>
    <style th:replace="~{fragments/styles :: admin-styles}"></style>
</head>
<body>
    <div class="header">
        <h1>Loyalty Backend - Admin Panel</h1>
    </div>

    <div class="container">
        <aside th:replace="~{fragments/sidebar :: sidebar}"></aside>

        <main class="main-content">
            <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
            <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

            <h2 th:text="${user.id != null ? 'Edit User' : 'New User'}">User Form</h2>

            <div class="card">
                <!-- Create form -->
                <form th:if="${user.id == null}"
                      th:action="@{/admin/users/new}"
                      th:object="${user}"
                      method="post">
                    <div class="form-group">
                        <label for="email-new">Email *</label>
                        <input type="email" id="email-new" th:field="*{email}" required>
                        <span th:if="${#fields.hasErrors('email')}"
                              th:errors="*{email}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="password-new">Password *</label>
                        <input type="password" id="password-new" th:field="*{password}" minlength="8" required>
                        <small>Minimum 8 characters</small>
                        <span th:if="${#fields.hasErrors('password')}"
                              th:errors="*{password}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="fullName-new">Full Name *</label>
                        <input type="text" id="fullName-new" th:field="*{fullName}" required minlength="2" maxlength="100">
                        <span th:if="${#fields.hasErrors('fullName')}"
                              th:errors="*{fullName}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="age-new">Age</label>
                        <input type="number" id="age-new" th:field="*{age}" min="0" max="150">
                        <span th:if="${#fields.hasErrors('age')}"
                              th:errors="*{age}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="mobileNumber-new">Mobile Number</label>
                        <input type="tel" id="mobileNumber-new" th:field="*{mobileNumber}">
                        <small>E.164 format (e.g., +1234567890)</small>
                        <span th:if="${#fields.hasErrors('mobileNumber')}"
                              th:errors="*{mobileNumber}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="role-new">Role *</label>
                        <select id="role-new" th:field="*{role}" required>
                            <option value="USER">USER</option>
                            <option value="ADMIN">ADMIN</option>
                        </select>
                        <span th:if="${#fields.hasErrors('role')}"
                              th:errors="*{role}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="totalPoints-new">Total Points</label>
                        <input type="number" id="totalPoints-new" th:field="*{totalPoints}" min="0" value="0">
                        <span th:if="${#fields.hasErrors('totalPoints')}"
                              th:errors="*{totalPoints}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="eventCount-new">Event Count</label>
                        <input type="number" id="eventCount-new" th:field="*{eventCount}" min="0" value="0">
                        <span th:if="${#fields.hasErrors('eventCount')}"
                              th:errors="*{eventCount}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="workingHours-new">Working Hours</label>
                        <input type="number" id="workingHours-new" th:field="*{workingHours}" min="0" value="0">
                        <span th:if="${#fields.hasErrors('workingHours')}"
                              th:errors="*{workingHours}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="aboutMe-new">About Me</label>
                        <textarea id="aboutMe-new" th:field="*{aboutMe}" maxlength="2000"></textarea>
                        <span th:if="${#fields.hasErrors('aboutMe')}"
                              th:errors="*{aboutMe}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn-primary">Create</button>
                        <a th:href="@{/admin/users}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>

                <!-- Edit form -->
                <form th:if="${user.id != null}"
                      th:action="@{/admin/users/edit/{id}(id=${user.id})}"
                      th:object="${user}"
                      method="post">

                    <div class="form-group">
                        <label for="email-edit">Email *</label>
                        <input type="email" id="email-edit" th:field="*{email}" required>
                        <span th:if="${#fields.hasErrors('email')}"
                              th:errors="*{email}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="password-edit">Password</label>
                        <input type="password" id="password-edit" th:field="*{password}" minlength="8">
                        <small>Leave blank to keep current password</small>
                        <span th:if="${#fields.hasErrors('password')}"
                              th:errors="*{password}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="fullName-edit">Full Name *</label>
                        <input type="text" id="fullName-edit" th:field="*{fullName}" required minlength="2" maxlength="100">
                        <span th:if="${#fields.hasErrors('fullName')}"
                              th:errors="*{fullName}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="age-edit">Age</label>
                        <input type="number" id="age-edit" th:field="*{age}" min="0" max="150">
                        <span th:if="${#fields.hasErrors('age')}"
                              th:errors="*{age}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="mobileNumber-edit">Mobile Number</label>
                        <input type="tel" id="mobileNumber-edit" th:field="*{mobileNumber}">
                        <small>E.164 format (e.g., +1234567890)</small>
                        <span th:if="${#fields.hasErrors('mobileNumber')}"
                              th:errors="*{mobileNumber}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="role-edit">Role *</label>
                        <select id="role-edit" th:field="*{role}" required>
                            <option value="USER">USER</option>
                            <option value="ADMIN">ADMIN</option>
                        </select>
                        <span th:if="${#fields.hasErrors('role')}"
                              th:errors="*{role}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="totalPoints-edit">Total Points</label>
                        <input type="number" id="totalPoints-edit" th:field="*{totalPoints}" min="0">
                        <span th:if="${#fields.hasErrors('totalPoints')}"
                              th:errors="*{totalPoints}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="eventCount-edit">Event Count</label>
                        <input type="number" id="eventCount-edit" th:field="*{eventCount}" min="0">
                        <span th:if="${#fields.hasErrors('eventCount')}"
                              th:errors="*{eventCount}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="workingHours-edit">Working Hours</label>
                        <input type="number" id="workingHours-edit" th:field="*{workingHours}" min="0">
                        <span th:if="${#fields.hasErrors('workingHours')}"
                              th:errors="*{workingHours}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="form-group">
                        <label for="aboutMe-edit">About Me</label>
                        <textarea id="aboutMe-edit" th:field="*{aboutMe}" maxlength="2000"></textarea>
                        <span th:if="${#fields.hasErrors('aboutMe')}"
                              th:errors="*{aboutMe}"
                              class="error"
                              style="color: red; font-size: 0.875rem;"></span>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <a th:href="@{/admin/users}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </main>
    </div>
</body>
</html>
